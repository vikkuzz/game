# Решение проблем с визитками

## Проблема: 404 при переходе на страницу визитки

### Причины

1. **In-memory хранилище теряет данные**
   - Визитки хранятся в памяти сервера (Map)
   - При перезагрузке dev сервера все данные теряются
   - В production при использовании нескольких инстансов сервера данные также могут теряться

2. **Визитка не активирована**
   - Визитки создаются с `isActive: false`
   - После оплаты визитка должна быть активирована
   - Если оплата не прошла или не обработалась, визитка остается неактивной

### Решения

#### Для разработки (временное)

1. Временно отключена проверка `isActive` в `src/app/card/[id]/page.tsx`
   - Визитки можно просматривать даже без активации
   - Это позволяет тестировать создание визиток

2. Добавлено логирование в `src/lib/businessCardStorage.ts`
   - Проверьте консоль сервера для диагностики
   - Логи покажут, найдена ли визитка и её статус

#### Для продакшена (постоянное)

1. **Используйте базу данных вместо in-memory хранилища**
   - Рекомендуется: PostgreSQL, MongoDB, или другой подходящий вариант
   - Обновите функции в `src/lib/businessCardStorage.ts`

2. **Включите проверку isActive в продакшене**
   - В `src/app/card/[id]/page.tsx` раскомментируйте `notFound()` для неактивных визиток

### Проверка работы

1. Создайте визитку через `/create-card`
2. Проверьте консоль сервера - должно быть сообщение о сохранении карты
3. Скопируйте ID визитки из консоли
4. Откройте `/card/[id]` где [id] - это ID визитки
5. Проверьте консоль - должна быть информация о загрузке карты

### Для тестирования оплаты

Если используете Яндекс.Кассу (`useYooKassa=true`):
- Форма оплаты перенаправит на страницу оплаты Яндекс.Кассы
- После успешной оплаты webhook активирует визитку
- Вернувшись на сайт, вы увидите успешную страницу

Если используете имитацию оплаты (`useYooKassa=false`):
- Заполните форму оплаты
- Через 2 секунды визитка будет активирована автоматически

### Отладка

Включите логирование в браузере (консоль разработчика):
- Проверьте, какой ID передается в URL
- Проверьте ответы API запросов

Включите логирование на сервере:
- Все операции с визитками логируются в консоль
- Проверьте логи при создании, активации и получении визиток





